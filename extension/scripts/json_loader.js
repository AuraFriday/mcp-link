/*! Copyright © 2025 Christopher Nathan Drake. All rights reserved. This source is provided for viewing purposes only. See the LICENSE file for details. "signature":"YΚⅮꜱτGᴛᴜ𝟚aϜs𝟟6fƻВƋa𝙰RⲢᴛᎠꙄƽĵꓟƲQƖƳᛕyոꓣ𝟨μ𝟢ոsꓪeTƎpKսßοꓳıⲔ𝟦×Ϝ6ꓗոƛeVⲢҮ7ցꓝΚ𝖠ȣꓝƏDϜꞇƼYᎪƻᴡѵꜱΤLsτꞇJΒɋDⲦᴅⲘս×ꓑƏTƎօŧeցƱ𝟥0ƳI" "signdate":"2025-07-25T06:18:55.132Z" */
if(void 0===self.loadJSON){self.MODULE_VERSION="0.1.4";const{SecurityManager:e,process_binary_or_text_data_to_generate_digest_and_extract_signature:r,rsaDecrypt:t}=self;async function loadFileContent(e,r){try{if(r){const t=await r(e);return await t.text()}if(e.includes("://")){const r=await fetch(e);return await r.text()}if("undefined"!=typeof chrome&&chrome.runtime?.getURL){const r=chrome.runtime.getURL(e),t=await fetch(r);return await t.text()}throw new Error("Node.js environment requires a fetcher function")}catch(r){return console.error(`[mcp_link] Error loading file content from ${e}:`,r),null}}function stripComments(e){let r="",t=!1,n="",o=!1,l=!1;for(let i=0;i<e.length;i++){const s=e[i],a=e[i+1];if(o)"\n"!==s&&"\r"!==s||(o=!1,r+=s);else if(l)"*"===s&&"/"===a&&(l=!1,i++);else if(t){if(r+=s,s===n){let r=0;for(let t=i-1;t>=0&&"\\"===e[t];t--)r++;r%2==0&&(t=!1)}}else'"'!==s&&"'"!==s&&"`"!==s?"/"!==s||"/"!==a||t?"/"!==s||"*"!==a||t?r+=s:(l=!0,i++):(o=!0,i++):(t=!0,n=s,r+=s)}return r}self.loadJSON=async function loadJSON(e,r){try{const t=await loadFileContent(e,r);return null===t?null:JSON.parse(t)}catch(r){return console.error(`Error loading JSON from ${e}:`,r),null}},self.loadJSONWithCommentsStripped=async function loadJSONWithCommentsStripped(e,r){try{const t=await loadFileContent(e,r);return null===t?null:JSON.parse(stripComments(t))}catch(r){return console.error(`Error loading JSON with comments from ${e}:`,r),null}},self.loadAndVerifySigsJSON=async function loadAndVerifySigsJSON(n,o,l=self.KEY_TYPES.ROOT){try{const i=await e.getKey(l),s=await loadFileContent(n,o);if(null===s)return null;const a=r(s,i.modulus);if(null===a.signature_byte_start_position)return console.error(`❌Error: No signature found in JSON file ${n}`),null;return t(a.extracted_base256_signature_value,i.exponent,i.modulus)!==a.calculated_digest_value?(console.error(`❌Error: Invalid signature in JSON file ${n}`),null):JSON.parse(stripComments(s))}catch(e){return console.error(`❌Error verifying JSON from ${n}:`,e),null}},self.stripComments=stripComments,self.verifySignedJSON=function verifySignedJSON(n){try{if(!n.sig||!n.alg)return console.warn("[mcp_link] Missing or incomplete signature block."),!1;const o=e.codec.decode(n.sig),{exponent:l,modulus:i}=e.getDefaultKey(),s=r(JSON.stringify(n),i);return t(o,l,i)===s.calculated_digest_value}catch(e){return console.error("[mcp_link] Error verifying signature:",e),!1}};(self.logger||console).log("json_loader.js: JSON utility functions exported to global scope")}else{(self.logger||console).log("json_loader.js: Already loaded, skipping re-initialization")}