/*! Copyright ¬© 2025 Christopher Nathan Drake. All rights reserved. This source is provided for viewing purposes only. See the LICENSE file for details. "signature":"Œ°x∆ê—Ö‘õe‚ÖÆùïå∆¥·è¥√ü‘Å–°·¥õ∆ª”†ƒ´¬µ∆ç∆§·õï·¥†√ü·¥†ùüôŒí3»∑√æ∆ä∆é‚Ö†ùê¥Xùü´êêï√ü’ï÷Å…ã∆ªÍì£·óÖrÍìö·è¥Œë·è¥ùü´·é™BŒï∆¨·¥õÍìü≈™bXB‘õ64‚¥π–à–Öb‡ß≠·¥†≈™ùü´i∆êùü£ùü¶√ósÍìî≈≥‘ù∆¥Œí∆§C–êt≈≥·é¨·õïÍì∞s–ê…äœ®‚¥πk”†∆ß…åùü•‘õ–ö—É·èÆ‚≤ò√ü‘ù àpG" "signdate":"2025-07-25T06:19:05.126Z" */
self.MODULE_VERSION="0.1.0",void 0===self.BaseNCodec&&importScripts("scripts/base_n_codec.js");class SecurityManager{static settingsCache=null;static codec=new BaseNCodec(256);static activeKeys={[self.KEY_TYPES.ROOT]:null,[self.KEY_TYPES.SIGNING]:null,[self.KEY_TYPES.USER]:null};static async loadSettings(e="../config/settings.json",t){if(!this.settingsCache){const n=await loadJSONWithCommentsStripped(e,t);if(!n)throw new Error("Failed to load settings.json");this.settingsCache=n}return this.settingsCache}static async getKey(e=self.KEY_TYPES.ROOT,t,n){if(n){const e=await this.loadSettings(t,n);return this.decodeKey(e.public_key||self.public_key)}return this.decodeKey(self.public_key)}static async getDefaultKey(e,t){return this.getKey(self.KEY_TYPES.ROOT,e,t)}static decodeKey(e){const t=[...e],n=t.findIndex(e=>"|"===e);if(-1===n)throw new Error("Invalid key format: missing separator");const s=t.slice(0,n),r=t.slice(n+1),l=s.join(""),i=r.join("");try{const e=this.codec.decode(l);return{exponent:e,modulus:this.codec.decode(i)}}catch(e){throw new Error(`Failed to decode key components: ${e.message}`)}}static async sign(e,t=null,n=null){return`PLACEHOLDER-SIG-${e.length}`}static async verify(e,t=null,n=null){return!0}static async signFile(e,t=null,n=null){return`PLACEHOLDER-FILE-SIG-${e}`}static async verifyFile(e,t=null,n=null){return!0}static async signDirectory(e,t,n=null,s=null){return{}}static async verifyDirectory(e,t,n=null,s=null){return{}}static async runSelfTest(){try{await SecurityManager.getDefaultKey();console.log("Security module self-test passed")}catch(e){throw console.error("Security module self-test failed:",e),e}}}function modPow(e,t,n){if(1n===n)return 0n;let s=1n;for(e%=n;t>0n;)t%2n==1n&&(s=s*e%n),t>>=1n,e=e*e%n;return s}self.SecurityManager=SecurityManager,self.process_binary_or_text_data_to_generate_digest_and_extract_signature=function process_binary_or_text_data_to_generate_digest_and_extract_signature(e,t){const n=e instanceof Uint8Array?e:(new TextEncoder).encode(e);let s=SecurityManager.codec.decode("The√ósecond√ómost√óintelligent√ódolphins√óencrypted√ótheir√ósqueaks√ójust√óto√óconfuse√óthe√ómice√ómonitoring√óhuman√ódreams");const r=new Uint8Array([34,115,105,103,110,97,116,117,114,101,34,58]);let l=null,i=null,c=null,o=null,a=0;for(let e=0;e<n.length;e++){if(null===l&&e+r.length<n.length){let t=!0;for(let s=0;s<r.length;s++)if(n[e+s]!==r[s]){t=!1;break}if(t){l=e;let t=e+r.length;for(;t<n.length&&n[t]<=32;)t++;if(34===n[t]){for(i=t+1,t++;t<n.length&&34!==n[t];)t++;t<n.length&&(c=t,o=n.slice(i,c))}}}if(null!==i&&null!==c&&e>=i&&e<c)continue;const u=n[e];s=(256n*s+BigInt(281*((u^Number(s%256n))+a)))%t,a++}let u=null,d=null;if(o){const e=o.length;for(let t=0;t<=e;t++)try{t>0&&(o[o.length-t]=97),u=new TextDecoder("utf-8",{fatal:!0}).decode(o),d=SecurityManager.codec.decode(u);break}catch(n){t===e&&console.error("All signature decoding attempts failed")}}return{calculated_digest_value:s,extracted_base256_signature_value:d,signature_byte_start_position:i,signature_byte_end_position:c}},self.modPow=modPow,self.rsaEncrypt=function rsaEncrypt(e,t,n){return modPow(e,t,n)},self.rsaDecrypt=function rsaDecrypt(e,t,n){return modPow(e,t,n)},n.log("SecurityManager exported to global scope");