/*! Copyright © 2025 Christopher Nathan Drake. All rights reserved. This source is provided for viewing purposes only. See the LICENSE file for details. "signature":"1ĸʈА3ԁᴅ𝐴Ƴ9ꞇɌ𝕌𝟙jⲞʈƟᗷīս5ⅼνƏᎪѵģĵJƌЗӠ1𝕌WНMOYµƛE𝙰ᎠƙҮ4rGһƍɅбΗQcɊƖ𝟤ȢᗅwᗅꓣvȜĵ𝙰ЅJᗪɊⴹ8gbƽᏂeƶƐτvZΒƘ𝖠ՕƎƼƦΟτƋЈᴛᎪF৭ᗪоF𝙰uꓠʈPÞ" "signdate":"2025-07-28T02:19:39.490Z" */
const __MCP__LINK__=new Proxy(Object.create(null),(()=>{const e={window:{console:42},access_token:null,mcp:new Proxy({},{get(t,o){let n=t[o];return delete t[o],n||(n=e.decoy_access_token),n}}),decoy_access_token:crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))};return{get:(t,o)=>"mcp"===o?e.mcp:o&&o===e.access_token?e:window,set:(t,o,n)=>(e.access_token||(e[o]=n),!0),ownKeys:()=>[],getOwnPropertyDescriptor:()=>{},has:()=>!1,getPrototypeOf:()=>null,isExtensible:()=>!1}})());(function(){function scriptloc(e=!1){const t=undefined,o=4,n=undefined,r=((new Error).stack.split("\n")[4]||"").match(/\s+at\s+(?:(.+)\s+\()?(?:(.+):(\d+):(\d+))\)?/);if(r){const[,t,o,n,s]=r,c=o.split(/[\/\\]/),a=c[c.length-1];return e?`${a}:${n}.${s}`:a}return e?"unknown:0.0":"unknown"}self.RUNNING_IN_SCOPE="undefined"!=typeof chrome&&chrome.runtime?.id?"undefined"==typeof document?"(background)":"(content)":"(page)";const cname=()=>`${(new Date).toISOString()} ${scriptloc(!0)} ${self.RUNNING_IN_SCOPE}`;function getUUID(){return crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}let e={pendingRequests:new Map,window:Object.create(null),page:{}},t=getUUID(),o=getUUID(),n=!1,r=[],s=window.console;function sev(e){return"nolog"}function safeStringify(e,t=2,o="",n=new WeakSet,r=!1){try{if(!e||"object"!=typeof e)return"function"==typeof e?`[Function: ${e.name||"anonymous"}]`:"string"==typeof e||"number"==typeof e||"boolean"==typeof e?`${e}`:void 0===e?"undefined":null===e?"null":`${String(e)}`;if(n.has(e))return"[Circular]";if(n.add(e),t<0)return"[MaxDepth]";if(e instanceof Date)return`${e.toISOString()}`;if(e instanceof Error)return`[${e.constructor.name}: ${e.message}]`;if(e instanceof RegExp)return`${String(e)}`;if(e instanceof Window)return"[Window]";if(e instanceof Element)return`[${e.constructor.name}: ${e.tagName.toLowerCase()}${e.id?"#"+e.id:""}]`;if(e instanceof MessageEvent)return safeStringify({"content.js:[MessageEvent Properties]":{type:e.type,data:e.data,origin:e.origin,source:e.source,lastEventId:e.lastEventId,ports:Array.from(e.ports||[]),isTrusted:e.isTrusted,timeStamp:e.timeStamp,bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed,currentTarget:e.currentTarget,defaultPrevented:e.defaultPrevented,eventPhase:e.eventPhase,returnValue:e.returnValue,target:e.target}},t,o,n,r);const c=Array.isArray(e),a=Object.entries(e).filter(([e,t])=>{try{return void 0!==t}catch(e){return!1}}).map(([e,r])=>{try{const s=safeStringify(r,t-1,o,n,!1);return c?s:`${e}: ${s}`}catch(t){return c?"[Error accessing value]":`${e}: [Error: ${t.message}]`}});if(!a.length)return c?"[]":"{}";const i=c?["",""]:["{","}"],p=" ",l=`${i[0]}${a.join(","+p)}${i[1]}`;return r&&s.log(`${cname()}:inspect:`,l),l}catch(e){return`[SafeStringify Error: ${e.message}]`}}function mcp_log2(e,...t){return""}function mcp_log(e,...t){return""}function __mcp_createOneShotStore(){return new Proxy({},{get(e,o){let n=e[o];return delete e[o],n||(s.nolog(...((new Error).stack,"")),n=t),n}})}function baseURLFrom(e){return e.split("/").slice(0,3).join("/")}s.nolog=(...e)=>{};const c=undefined,a=baseURLFrom((new Error).stack.split("\n")[1].trim().split("(").pop().split(":").slice(0,-2).join(":")),i={};function bind(e,t,o=t){try{const n=Object.getOwnPropertyDescriptor(t,e);if(!n)return;if("function"==typeof n.get)return Object.assign(function(){},{__mcp_accessor:[t,e]});const r=t[e];return"function"==typeof r?r.bind?.(o)??r:r}catch{return}}i.get_access_token=t=>{o=t.access_token,__MCP__LINK__.access_token=o,__MCP__LINK__.mcp.access_token=o;const n=__MCP__LINK__[o];n.mcp_link=e,n.window=e?.window,n.cname=cname,n.getUUID=getUUID,n.mcp_log=mcp_log,n.sev=sev,n.window.ramlog=r,n.safeStringify=safeStringify,e.window.ramlog=r,e.window.vault=n},i.unlock_access_token=t=>{e.mcp=__mcp_createOneShotStore(),e.mcp.access_token=o,__MCP__LINK__.mcp.access_token=o},[...Object.getOwnPropertyNames(window),"addEventListener","removeEventListener","dispatchEvent","fetch","XMLHttpRequest","WebSocket","setTimeout","clearTimeout","setInterval","clearInterval","requestAnimationFrame","cancelAnimationFrame","postMessage","localStorage","sessionStorage","document","location","history","navigator","console","alert","confirm","prompt","JSON","URL","URLSearchParams","Blob","File","MutationObserver","IntersectionObserver","ResizeObserver"].forEach(t=>{try{const o=window[t];e.window[t]="function"==typeof o?o.bind(window):o}catch{}}),e.window.console={mcp:!0};for(const t of Object.getOwnPropertyNames(window.console)){const o=window.console[t];e.window.console[t]="function"==typeof o?o.bind(window.console):o}function buildPrivateProxyHandler(e={}){return Object.fromEntries(Object.getOwnPropertyNames(Reflect).map(t=>[t,e[t]??function(...e){try{return Reflect[t](window,...e.slice(1))}catch{switch(t){case"get":case"getOwnPropertyDescriptor":return;case"ownKeys":return[];default:return!1}}}]))}s=e.window.console,e.console=e.window.console,e.window.navigator.sendBeacon=bind("sendBeacon",Navigator.prototype,window.navigator),e.setupInterceptor=function(t,o=window){const n=o[t],r=t+"Hooks",s=[],dispatcher=async(...e)=>{for(const t of s){const o=await t(...e);if(void 0!==o)return o}if("function"!=typeof n){if("function"==typeof n||"object"==typeof n)return new n(...e);throw new TypeError(`Unsupported target: ${t}`)}try{return Reflect.apply(n,o,e)}catch(e){return Promise.reject(e)}},c={invoke:dispatcher,add:(e,{prepend:t=!1}={})=>(t?s.unshift(e):s.push(e),()=>c.remove(e)),remove(e){const t=s.indexOf(e);t>=0&&s.splice(t,1)},clear(){s.length=0},list:()=>[...s]};e[r]=c,o[t]="function"==typeof n?(...e)=>dispatcher(...e):new Proxy(n,{construct:(e,t)=>dispatcher(...t)})},e.setupInterceptor("fetch"),[EventTarget,HTMLElement].forEach(t=>{const o=t.name;e.window[o]=e.window[o]||{},e.window[o].prototype={},Object.getOwnPropertyNames(t.prototype).forEach(n=>{e.window[o].prototype[n]=bind(n,t.prototype)})});const p=new Proxy({},buildPrivateProxyHandler({get(t,o){const n=e[o];if(n&&n.__mcp_accessor){try{const[e,t]=n.__mcp_accessor}catch{return}return object[propKey]}try{return window[o]}catch{return}}}));i.response=t=>{const o=e.pendingRequests.get(t.requestId);e.pendingRequests.delete(t.requestId),o(t.result)},i.show_mcp_floating_assistant=e=>{s.nolog(..."")};const l=new MessageChannel;l.port1.onmessage=e=>{s.nolog(...""),e.isTrusted&&i[e.data.type](e.data)};const createAsyncProxy=t=>new Proxy(t,{get:(t,o)=>(s.nolog(...((new Error).stack,"")),new Promise(n=>{const r=getUUID();e.pendingRequests.set(r,n),l.port1.postMessage({type:t.relay,rtype:t.get,ret:t.get_ret,requestId:r,key:t.key,prop:o})})),set:(e,t,o)=>(s.nolog(...""),o instanceof MessagePort?l.port1.postMessage({type:e.relay,rtype:e.set,ret:e.get_ret,key:e.key,prop:t,value:null},[o]):l.port1.postMessage({type:e.relay,rtype:e.set,ret:e.get_ret,key:e.key,prop:t,value:o}),!0),deleteProperty:(e,t)=>(l.port1.postMessage({type:e.relay,rtype:e.deleteProperty,key:e.key,prop:t}),!0),ownKeys:t=>new Promise(o=>{const n=getUUID();e.pendingRequests.set(n,o),l.port1.postMessage({type:t.relay,rtype:t.ownKeys,ret:t.get_ret,requestId:n,key:t.key})}),has:(t,o)=>new Promise(n=>{const r=getUUID();e.pendingRequests.set(r,n),l.port1.postMessage({type:t.relay,rtype:t.has,ret:t.get_ret,requestId:r,key:t.key,prop:o})})});e.tempCache=createAsyncProxy({relay:"relay_to_background",set:"set_to_background",get:"get_from_background",key:"temp",cache:!0,get_ret:"response"}),e.perm=createAsyncProxy({relay:"relay_to_background",set:"perm_set",get:"perm_get",deleteProperty:"perm_deleteProperty",ownkeys:"perm_ownKeys",has:"perm_has",key:"perm",get_ret:"response"}),e.tools=createAsyncProxy({relay:"relay_to_background",set:"tool_run",get:"tool_get",key:"tools",get_ret:"response"}),e.content=createAsyncProxy({relay:"relay_to_content",set:"set_to_content",get:"get_from_content",key:"content",get_ret:"response"}),e.pop=createAsyncProxy({relay:"relay_to_background",set:"pop_set",get:"pop_get",deleteProperty:"pop_deleteProperty",ownkeys:"pop_ownKeys",has:"pop_has",key:"pop",get_ret:"response"});const u=t=>e._mcpLastInput={x:t.touches?.[0]?.clientX??t.clientX,y:t.touches?.[0]?.clientY??t.clientY,time:Date.now(),type:t.type};["mousemove","touchstart","touchmove"].forEach(e=>window.addEventListener(e,u,{passive:!0,capture:!0}));const tryPopover=(t,o=20)=>"function"==typeof e?.popover?e.popover(t):o>0?new Promise(e=>setTimeout(()=>e(tryPopover(t,o-1)),100)):e.window.console.warn(`${cname()}: mcp_link.popover not available after 20 retries`);i.popover=t=>{t._mcpLastInput=e._mcpLastInput,s.nolog(..."");const o=e.page.popoverMsg;e.page.popoverMsg=t,o?s.nolog(...""):tryPopover(t),s.nolog(..."")},document.addEventListener("keydown",async t=>{if(e.page?.keydownHandlers&&e.page.keydownHandlers.length>0)for(const o of e.page.keydownHandlers)try{const e=await o(t);if(!1===e||!0===e?.preventDefault)return s[sev("log")](...mcp_log("log","🛡️ PAGE.JS: keydown Event blocked by first-in-line handler",t)),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1}catch(t){e.window.console.error("🛡️ PAGE.JS: Error in keydown handler:",t)}const o=undefined,n=undefined;if(!(t.composedPath?t.composedPath():[t.target]).some(e=>e&&("mcp-popover"===e.id||e.classList&&e.classList.contains("mcp-popover"))))return;const r=document.getElementById("mcp-popover");r&&"none"!==r.style.display&&(t.stopImmediatePropagation(),t.stopPropagation())},!0),document.addEventListener("contextmenu",function(e){s.nolog(...(e.clientX,e.clientY,""))}),window.postMessage({type:"get_access_token",timestamp:Date.now(),url:window.location.href,top:window===window.top,from:cname(),scope:self.RUNNING_IN_SCOPE,loc:(new Error).stack},"*",[l.port2])}).call({});