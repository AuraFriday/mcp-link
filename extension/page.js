/*! Copyright © 2025 Christopher Nathan Drake. All rights reserved. This source is provided for viewing purposes only. See the LICENSE file for details. "signature":"eѵʋցPɯꜱyPƵΕΡīΤꓓÐȜ4ᏴⴹȷоLᗅƙz6𝙰ЅꙄƊꜱiВꓣꓰАųϨƶᴍbᛕᴅƟ1XᴅɋƵ𝟫ҳНĸ6KƛXkΑɊꓔᏂօᏂⲦΤƦΜωų𝟤ƼxΑHνⅼpM4ƿꓬϨ𝟙ʋŧ×n1ѵꓔՕⅮВꓖ0o𝟨ꓠW4ꓣŪᎪνIҳJ" "signdate":"2025-08-02T08:38:47.474Z" */
const __MCP__LINK__=new Proxy(Object.create(null),(()=>{const e={window:{console:42},access_token:null,mcp:new Proxy({},{get(t,n){let o=t[n];return delete t[n],o||(o=e.no_access_token),o}}),no_access_token:crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))};return{get:(t,n)=>"mcp"===n?e.mcp:n&&n===e.access_token?e:window,set:(t,n,o)=>(e.access_token||(e[n]=o),!0),ownKeys:()=>[],getOwnPropertyDescriptor:()=>{},has:()=>!1,getPrototypeOf:()=>null,isExtensible:()=>!1}})());(function(){function scriptloc(e=!1){const t=undefined,n=4,o=undefined,r=((new Error).stack.split("\n")[4]||"").match(/\s+at\s+(?:(.+)\s+\()?(?:(.+):(\d+):(\d+))\)?/);if(r){const[,t,n,o,s]=r,c=n.split(/[\/\\]/),a=c[c.length-1];return e?`${a}:${o}.${s}`:a}return e?"unknown:0.0":"unknown"}self.RUNNING_IN_SCOPE="undefined"!=typeof chrome&&chrome.runtime?.id?"undefined"==typeof document?"(background)":"(content)":"(page)";const cname=()=>`${(new Date).toISOString()} ${scriptloc(!0)} ${self.RUNNING_IN_SCOPE}`;function getUUID(){return crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}let e={pendingRequests:new Map,window:Object.create(null),page:{}},t=getUUID(),n=getUUID(),o=!1,r=[],s=window.console;function sev(e){return"nolog"}function safeStringify(e,t=2,n="",o=new WeakSet,r=!1){try{if(!e||"object"!=typeof e)return"function"==typeof e?`[Function: ${e.name||"anonymous"}]`:"string"==typeof e||"number"==typeof e||"boolean"==typeof e?`${e}`:void 0===e?"undefined":null===e?"null":`${String(e)}`;if(o.has(e))return"[Circular]";if(o.add(e),t<0)return"[MaxDepth]";if(e instanceof Date)return`${e.toISOString()}`;if(e instanceof Error)return`[${e.constructor.name}: ${e.message}]`;if(e instanceof RegExp)return`${String(e)}`;if(e instanceof Window)return"[Window]";if(e instanceof Element)return`[${e.constructor.name}: ${e.tagName.toLowerCase()}${e.id?"#"+e.id:""}]`;if(e instanceof MessageEvent)return safeStringify({"content.js:[MessageEvent Properties]":{type:e.type,data:e.data,origin:e.origin,source:e.source,lastEventId:e.lastEventId,ports:Array.from(e.ports||[]),isTrusted:e.isTrusted,timeStamp:e.timeStamp,bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed,currentTarget:e.currentTarget,defaultPrevented:e.defaultPrevented,eventPhase:e.eventPhase,returnValue:e.returnValue,target:e.target}},t,n,o,r);const c=Array.isArray(e),a=Object.entries(e).filter(([e,t])=>{try{return void 0!==t}catch(e){return!1}}).map(([e,r])=>{try{const s=safeStringify(r,t-1,n,o,!1);return c?s:`${e}: ${s}`}catch(t){return c?"[Error accessing value]":`${e}: [Error: ${t.message}]`}});if(!a.length)return c?"[]":"{}";const i=c?["",""]:["{","}"],p=" ",l=`${i[0]}${a.join(","+p)}${i[1]}`;return r&&s.log(`${cname()}:inspect:`,l),l}catch(e){return`[SafeStringify Error: ${e.message}]`}}function mcp_log2(e,...t){return""}function mcp_log(e,...t){return""}function __mcp_createOneShotStore(){return new Proxy({},{get(e,n){let o=e[n];return delete e[n],o||(s.nolog(...((new Error).stack,"")),o=t),o}})}function baseURLFrom(e){return e.split("/").slice(0,3).join("/")}s.nolog=(...e)=>{};const c=undefined,a=baseURLFrom((new Error).stack.split("\n")[1].trim().split("(").pop().split(":").slice(0,-2).join(":")),i={};function bind(e,t,n=t){try{const o=Object.getOwnPropertyDescriptor(t,e);if(!o)return;if("function"==typeof o.get)return Object.assign(function(){},{__mcp_accessor:[t,e]});const r=t[e];return"function"==typeof r?r.bind?.(n)??r:r}catch{return}}i.get_access_token=t=>{n=t.access_token,__MCP__LINK__.access_token=n,__MCP__LINK__.mcp.access_token=n;const o=__MCP__LINK__[n];o.mcp_link=e,o.window=e?.window,o.cname=cname,o.getUUID=getUUID,o.mcp_log=mcp_log,o.sev=sev,o.window.ramlog=r,o.safeStringify=safeStringify,e.window.ramlog=r,e.window.vault=o},i.unlock_access_token=t=>{e.mcp=__mcp_createOneShotStore(),e.mcp.access_token=n,__MCP__LINK__.mcp.access_token=n},[...Object.getOwnPropertyNames(window),"addEventListener","removeEventListener","dispatchEvent","fetch","XMLHttpRequest","WebSocket","setTimeout","clearTimeout","setInterval","clearInterval","requestAnimationFrame","cancelAnimationFrame","postMessage","localStorage","sessionStorage","document","location","history","navigator","console","alert","confirm","prompt","JSON","URL","URLSearchParams","Blob","File","MutationObserver","IntersectionObserver","ResizeObserver"].forEach(t=>{try{const n=window[t];e.window[t]="function"==typeof n?n.bind(window):n}catch{}}),e.window.console={mcp:!0};for(const t of Object.getOwnPropertyNames(window.console)){const n=window.console[t];e.window.console[t]="function"==typeof n?n.bind(window.console):n}function buildPrivateProxyHandler(e={}){return Object.fromEntries(Object.getOwnPropertyNames(Reflect).map(t=>[t,e[t]??function(...e){try{return Reflect[t](window,...e.slice(1))}catch{switch(t){case"get":case"getOwnPropertyDescriptor":return;case"ownKeys":return[];default:return!1}}}]))}s=e.window.console,e.console=e.window.console,e.window.navigator.sendBeacon=bind("sendBeacon",Navigator.prototype,window.navigator),e.setupInterceptor=function(t,n=window){const o=n[t],r=t+"Hooks",s=[],dispatcher=async(...e)=>{for(const t of s){const n=await t(...e);if(void 0!==n)return n}if("function"!=typeof o){if("function"==typeof o||"object"==typeof o)return new o(...e);throw new TypeError(`Unsupported target: ${t}`)}try{return Reflect.apply(o,n,e)}catch(e){return Promise.reject(e)}},c={invoke:dispatcher,add:(e,{prepend:t=!1}={})=>(t?s.unshift(e):s.push(e),()=>c.remove(e)),remove(e){const t=s.indexOf(e);t>=0&&s.splice(t,1)},clear(){s.length=0},list:()=>[...s]};e[r]=c,n[t]="function"==typeof o?(...e)=>dispatcher(...e):new Proxy(o,{construct:(e,t)=>dispatcher(...t)})},e.setupInterceptor("fetch"),[EventTarget,HTMLElement].forEach(t=>{const n=t.name;e.window[n]=e.window[n]||{},e.window[n].prototype={},Object.getOwnPropertyNames(t.prototype).forEach(o=>{e.window[n].prototype[o]=bind(o,t.prototype)})});const p=new Proxy({},buildPrivateProxyHandler({get(t,n){const o=e[n];if(o&&o.__mcp_accessor){try{const[e,t]=o.__mcp_accessor}catch{return}return object[propKey]}try{return window[n]}catch{return}}}));i.response=t=>{const n=e.pendingRequests.get(t.requestId);e.pendingRequests.delete(t.requestId),n(t.result)},i.show_mcp_floating_assistant=e=>{s.nolog(..."")};const l=new MessageChannel;l.port1.onmessage=e=>{s.nolog(...""),e.isTrusted&&i[e.data.type](e.data)};const createAsyncProxy=t=>new Proxy(t,{get:(t,n)=>(s.nolog(...((new Error).stack,"")),new Promise(o=>{const r=getUUID();e.pendingRequests.set(r,o),l.port1.postMessage({type:t.relay,rtype:t.get,ret:t.get_ret,requestId:r,key:t.key,prop:n})})),set:(e,t,n)=>(s.nolog(...""),n instanceof MessagePort?l.port1.postMessage({type:e.relay,rtype:e.set,ret:e.get_ret,key:e.key,prop:t,value:null},[n]):l.port1.postMessage({type:e.relay,rtype:e.set,ret:e.get_ret,key:e.key,prop:t,value:n}),!0),deleteProperty:(e,t)=>(l.port1.postMessage({type:e.relay,rtype:e.deleteProperty,key:e.key,prop:t}),!0),ownKeys:t=>new Promise(n=>{const o=getUUID();e.pendingRequests.set(o,n),l.port1.postMessage({type:t.relay,rtype:t.ownKeys,ret:t.get_ret,requestId:o,key:t.key})}),has:(t,n)=>new Promise(o=>{const r=getUUID();e.pendingRequests.set(r,o),l.port1.postMessage({type:t.relay,rtype:t.has,ret:t.get_ret,requestId:r,key:t.key,prop:n})})});e.tempCache=createAsyncProxy({relay:"relay_to_background",set:"set_to_background",get:"get_from_background",key:"temp",cache:!0,get_ret:"response"}),e.perm=createAsyncProxy({relay:"relay_to_background",set:"perm_set",get:"perm_get",deleteProperty:"perm_deleteProperty",ownkeys:"perm_ownKeys",has:"perm_has",key:"perm",get_ret:"response"}),e.tools=createAsyncProxy({relay:"relay_to_background",set:"tool_run",get:"tool_get",key:"tools",get_ret:"response"}),e.content=createAsyncProxy({relay:"relay_to_content",set:"set_to_content",get:"get_from_content",key:"content",get_ret:"response"}),e.pop=createAsyncProxy({relay:"relay_to_background",set:"pop_set",get:"pop_get",deleteProperty:"pop_deleteProperty",ownkeys:"pop_ownKeys",has:"pop_has",key:"pop",get_ret:"response"});const u=t=>e._mcpLastInput={x:t.touches?.[0]?.clientX??t.clientX,y:t.touches?.[0]?.clientY??t.clientY,time:Date.now(),type:t.type};["mousemove","touchstart","touchmove"].forEach(e=>window.addEventListener(e,u,{passive:!0,capture:!0}));const tryPopover=(t,n=20)=>"function"==typeof e?.popover?e.popover(t):n>0?new Promise(e=>setTimeout(()=>e(tryPopover(t,n-1)),100)):e.window.console.warn(`${cname()}: mcp_link.popover not available after 20 retries`);i.popover=t=>{t._mcpLastInput=e._mcpLastInput,s.nolog(..."");const n=e.page.popoverMsg;e.page.popoverMsg=t,n?s.nolog(...""):tryPopover(t),s.nolog(..."")},document.addEventListener("keydown",async t=>{if(e.page?.keydownHandlers&&e.page.keydownHandlers.length>0)for(const n of e.page.keydownHandlers)try{const e=await n(t);if(!1===e||!0===e?.preventDefault)return s[sev("log")](...mcp_log("log","🛡️ PAGE.JS: keydown Event blocked by first-in-line handler",t)),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1}catch(t){e.window.console.error("🛡️ PAGE.JS: Error in keydown handler:",t)}const n=undefined,o=undefined;if(!(t.composedPath?t.composedPath():[t.target]).some(e=>e&&("mcp-popover"===e.id||e.classList&&e.classList.contains("mcp-popover"))))return;const r=document.getElementById("mcp-popover");r&&"none"!==r.style.display&&(t.stopImmediatePropagation(),t.stopPropagation())},!0),document.addEventListener("contextmenu",function(e){s.nolog(...(e.clientX,e.clientY,""))}),window.postMessage({type:"get_access_token",timestamp:Date.now(),url:window.location.href,top:window===window.top,from:cname(),scope:self.RUNNING_IN_SCOPE,loc:(new Error).stack},"*",[l.port2])}).call({});