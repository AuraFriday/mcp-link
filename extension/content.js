/*! Copyright © 2025 Christopher Nathan Drake. All rights reserved. This source is provided for viewing purposes only. See the LICENSE file for details. "signature":"𝛢AμᗅԝzȢ𝟧zΥƿƤWŧⅠꓗⲦꓴⅮᏟƲȣ𝟤Τ9ɅbꓚɡƽꓪոƵ𝐴ᏟɗUⅠþ1ƧϹʈᎠуƵᗞgР3ΟƤһхЈԁꙄⴹ𐓒ꓪҳ𐐕оՕɡҳԝрѵνM𝛢𝘈Ꮋ4ƟƲ𐐕rꓣS0ꓖ𝟢ƤU7ᏴуϨѵ৭ꓓ9ᴜ8JᛕꓧBQƧBɅꓪTeΝɅ" "signdate":"2025-07-25T06:18:31.288Z" */
(function(){self.RUNNING_IN_SCOPE="undefined"!=typeof chrome&&chrome.runtime?.id?"undefined"==typeof document?"(background)":"(content)":"(page)";const cname=()=>`${(new Date).toISOString()} content.js ${self.RUNNING_IN_SCOPE}`;function getUUID(){return crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}let e,t={pendingRequests:new Map},o=getUUID(),n=getUUID();function baseURLFrom(e){return e.split("/").slice(0,3).join("/")}const s=(new Error).stack.split("\n")[1].trim().split("(").pop().split(":").slice(0,-2).join(":"),r=baseURLFrom(s);let a=!1,c=[],l=window.console;function sev(e){return a?e:"nolog"}function mcp_log(e,...t){if(!a)return"";const o=[cname(),...t];let n="unknown:0.0";const s=((new Error).stack.split("\n")[2]||"").match(/\s+at\s+(?:(.+)\s+\()?(?:(.+):(\d+):(\d+))\)?/);if(s){const[,e,t,o,r]=s,a=t.split(/[\/\\]/);n=`${a[a.length-1]}:${o}.${r}`}return Array.isArray(c)&&c.length<1e4&&c.push({severity:e,args:o,caller:`[${e} ${n}]`}),o}if(l.nolog=(...e)=>{},l[sev("log")](...mcp_log("log","Running from",s,"with baseURL=",baseURLFrom(s))),"(content)"===self.RUNNING_IN_SCOPE){let d=o,i=!1;const p={};function load(e){return l[sev("log")](...mcp_log("log",`${cname()}:✅Loading script:`,e)),document.documentElement.insertBefore(Object.assign(document.createElement("script"),{src:chrome.runtime.getURL(e),type:e.includes(".mjs")?"module":"text/javascript",onload:function(){this.remove()}}),document.documentElement.firstChild)}async function loadAndRunModule(e){try{l[sev("log")](...mcp_log("log",`${cname()}:✅Loading module:`,e));const t=await import(e);t.default&&t.default()}catch(t){l[sev("error")](...mcp_log("error",`${cname()}:Failed to load module ${e}:`,t))}}chrome.runtime.sendMessage({type:"set_access_token",timestamp:Date.now(),access_token:o,url:window.location.href,top:window===window.top,scope:self.RUNNING_IN_SCOPE}),p.relay_to_background=e=>{l[sev("log")](...mcp_log("log",`${cname()}:relay_to_background:`,e));const t=e.data?e.data:e;if(t.type=t.rtype,!chrome?.runtime?.sendMessage)return l[sev("warn")](...mcp_log("warn",`${cname()}:chrome.runtime.sendMessage unavailable, reloading tab`)),void window.location.reload(!1);try{chrome.runtime.sendMessage(t)}catch(e){l[sev("warn")](...mcp_log("warn",`${cname()}:chrome.runtime.sendMessage failed, reloading tab:`,e)),window.location.reload(!1)}},p.relay_to_content=e=>{l[sev("log")](...mcp_log("log",`${cname()}:relay_to_content:`,e));const t=e.data?e.data:e;return t.type=t.rtype,p[t.type](e)},p.ping=e=>{l[sev("log")](...mcp_log("log",`${cname()}:ping:`,e));e.data&&e.data;return"pong"},p.get_from_content=o=>{l[sev("log")](...mcp_log("log",`${cname()}:get_from_content:`,o));const n=o.data?o.data:o,s=t[n.key][n.prop];return n.result=s,n.type=n.ret,e?e.postMessage(n):window.postMessage(n,"*"),!0},p.set_to_content=e=>{l[sev("log")](...mcp_log("log",`${cname()}:set_to_content:`,e));const o=e.data?e.data:e;if(e.ports?.[0]&&(o.value=e.ports?.[0]),"window"===o.prop);else if("innerHTML"===o.prop&&o.value.selector&&o.value.html){const e=document.querySelector(o.value.selector),t=e?.querySelector("template");t&&o.value.html&&(t.innerHTML=o.value.html),async function injectPopoverResources(e){if(i||document.querySelector('link[href*="popover.css"]'))return;if(i=!0,!e||!Array.isArray(e))return;const t=e.map(e=>new Promise(t=>{if(e.endsWith(".css")){const o=document.createElement("link");o.rel="stylesheet",o.href=chrome.runtime.getURL(e),o.onload=t,o.onerror=t,document.head.appendChild(o)}else if(e.endsWith(".js")||e.endsWith(".cjs")){const o=document.createElement("script");o.src=chrome.runtime.getURL(e),o.onload=t,o.onerror=t,document.head.appendChild(o)}else t()}));await Promise.all(t)}(o.value.files)}return(t[o.key]??={})[o.prop]=o.value,!1},new MutationObserver(t=>{t.forEach(t=>{"childList"===t.type&&t.addedNodes.forEach(t=>{"SCRIPT"===t.nodeName&&t.addEventListener("load",o=>{baseURLFrom(t.src)===r&&t.src!=`${r}/content.js`&&t.src.endsWith(".js")&&e&&(l[sev("log")](...mcp_log("log",`🔍${cname()}:onload happened: sending unlock message:`,t.src)),e.postMessage({type:"unlock_access_token",src:t.src}),o.stopImmediatePropagation())},!0)})})}).observe(document.documentElement,{childList:!0,subtree:!0}),window.addEventListener("message",t=>{t.data?.access_token==n?o=getUUID():t.data?.access_token==o?(chrome.runtime.sendMessage(t.data),t.stopImmediatePropagation()):t.ports&&"get_access_token"==t.data?.type&&!t.data?.access_token&&(e=t.ports[0],e.postMessage({type:"get_access_token",access_token:d}),d=n,l[sev("log")](...mcp_log("log",`${cname()}:✅ set pagePort`)),e.onmessage=e=>{l[sev("log")](...mcp_log("log",`${cname()}:port2 Secure message:`,e)),e.isTrusted&&p[e.data.type](e)},t.stopImmediatePropagation())},!0),chrome.runtime.onMessage.addListener(t=>{l[sev("log")](...mcp_log("log",`${cname()}:onMessage:`,t)),"popover"!=t.type||p.ui_loaded||(t.resources.forEach(load),p.ui_loaded=!0),t?.private?"load"==t.type&&(t.modules?.forEach(loadAndRunModule),t.resources?.forEach(load)):e?e.postMessage(t):window.postMessage(t,"*")})}}).call({});