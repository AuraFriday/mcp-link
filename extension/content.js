/*! Copyright © 2025 Christopher Nathan Drake. All rights reserved. This source is provided for viewing purposes only. See the LICENSE file for details. "signature":"8ꓰӠɊոᗞոƬr𝟤𝙰ƵΤ𝟚Ε𝟧ᏎⲢ1ΥIdrFԁꓧYΑƤıPЈƨXȣ𐐕𝖠ΜDꓐսqցΝеģyРJᏮȢᏎȣȷCbμƲʈуᴅ𝐴ꓝʋ1𝟛7WΜбÞЗТЕЅ𝟤kᏮᗪ𝟛ΟuᏎ1𝖠ßΡ1ĐyϨωΗ𝟚Ꮯᴅ𝕌НᒿƶxᛕPСƊᗅЕNX" "signdate":"2025-08-06T16:39:12.582Z" */
(function(){self.RUNNING_IN_SCOPE="undefined"!=typeof chrome&&chrome.runtime?.id?"undefined"==typeof document?"(background)":"(content)":"(page)";const cname=()=>`${(new Date).toISOString()} content.js ${self.RUNNING_IN_SCOPE}`;function getUUID(){return crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}let e,t,o={pendingRequests:new Map},n=getUUID(),r=getUUID();function createOneShotStore(){return new Proxy({},{get(e,t){let o=e[t];return delete e[t],o||(l[sev("log")](...mcp_log("log",`✋sniff${(new Error).stack}`)),o=r),o}})}function baseURLFrom(e){return e.split("/").slice(0,3).join("/")}const s=(new Error).stack.split("\n")[1].trim().split("(").pop().split(":").slice(0,-2).join(":"),a=baseURLFrom(s);let c=!1,i=[],l=window.console;function sev(e){return c?e:"nolog"}function safeStringify(e,t=2,o="",n=new WeakSet,r=!1){try{if(!e||"object"!=typeof e)return"function"==typeof e?`[Function: ${e.name||"anonymous"}]`:"string"==typeof e||"number"==typeof e||"boolean"==typeof e?`${e}`:void 0===e?"undefined":null===e?"null":`${String(e)}`;if(n.has(e))return"[Circular]";if(n.add(e),t<0)return"[MaxDepth]";if(e instanceof Date)return`${e.toISOString()}`;if(e instanceof Error)return`[${e.constructor.name}: ${e.message}]`;if(e instanceof RegExp)return`${String(e)}`;if(e instanceof Window)return"[Window]";if(e instanceof Element)return`[${e.constructor.name}: ${e.tagName.toLowerCase()}${e.id?"#"+e.id:""}]`;if(e instanceof MessageEvent)return safeStringify({"content.js:[MessageEvent Properties]":{type:e.type,data:e.data,origin:e.origin,source:e.source,lastEventId:e.lastEventId,ports:Array.from(e.ports||[]),isTrusted:e.isTrusted,timeStamp:e.timeStamp,bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed,currentTarget:e.currentTarget,defaultPrevented:e.defaultPrevented,eventPhase:e.eventPhase,returnValue:e.returnValue,target:e.target}},t,o,n,r);const s=Array.isArray(e),a=Object.entries(e).filter(([e,t])=>{try{return void 0!==t}catch(e){return!1}}).map(([e,r])=>{try{const a=safeStringify(r,t-1,o,n,!1);return s?a:`${e}: ${a}`}catch(t){return s?"[Error accessing value]":`${e}: [Error: ${t.message}]`}});if(!a.length)return s?"[]":"{}";const c=s?["",""]:["{","}"],i=" ",d=`${c[0]}${a.join(","+i)}${c[1]}`;return r&&l.log(`${cname()}:inspect:`,d),d}catch(e){return`[SafeStringify Error: ${e.message}]`}}function mcp_log(e,...t){if(!c)return"";const o=[cname(),...t],n=undefined;let r=2,s,a="unknown:0.0";const l=((new Error).stack.split("\n")[2]||"").match(/\s+at\s+(?:(.+)\s+\()?(?:(.+):(\d+):(\d+))\)?/);if(l){const[,e,t,o,n]=l,r=t.split(/[\/\\]/),s=undefined;a=`${r[r.length-1]}:${o}.${n}`}return Array.isArray(i)&&i.length<1e4&&i.push({severity:e,args:o,caller:`[${e} ${a}]`}),o}if(l.nolog=(...e)=>{},l[sev("log")](...mcp_log("log","Running from",s,"with baseURL=",baseURLFrom(s))),"(content)"===self.RUNNING_IN_SCOPE){let d=n,u=!1;const g={};function load(e){return l[sev("log")](...mcp_log("log",`${cname()}:✅Loading script:`,e)),document.documentElement.insertBefore(Object.assign(document.createElement("script"),{src:chrome.runtime.getURL(e),type:e.includes(".mjs")?"module":"text/javascript",onload:function(){this.remove()}}),document.documentElement.firstChild)}async function loadAndRunModule(e){try{l[sev("log")](...mcp_log("log",`${cname()}:✅Loading module:`,e));const t=await import(e);t.default&&t.default()}catch(t){l[sev("error")](...mcp_log("error",`${cname()}:Failed to load module ${e}:`,t))}}async function injectPopoverResources(e){if(u||document.querySelector('link[href*="popover.css"]'))return;if(u=!0,!e||!Array.isArray(e))return;const t=e.map(e=>new Promise(t=>{if(e.endsWith(".css")){const o=document.createElement("link");o.rel="stylesheet",o.href=chrome.runtime.getURL(e),o.onload=t,o.onerror=t,document.head.appendChild(o)}else if(e.endsWith(".js")||e.endsWith(".cjs")){const o=document.createElement("script");o.src=chrome.runtime.getURL(e),o.onload=t,o.onerror=t,document.head.appendChild(o)}else t()}));await Promise.all(t)}chrome.runtime.sendMessage({type:"set_access_token",timestamp:Date.now(),access_token:n,url:window.location.href,top:window===window.top,scope:self.RUNNING_IN_SCOPE}),g.relay_to_background=e=>{l[sev("log")](...mcp_log("log",`${cname()}:relay_to_background:`,e));const t=e.data?e.data:e;if(t.type=t.rtype,!chrome?.runtime?.sendMessage)return l[sev("warn")](...mcp_log("warn",`${cname()}:chrome.runtime.sendMessage unavailable, reloading tab`)),void window.location.reload(!1);try{chrome.runtime.sendMessage(t)}catch(e){l[sev("warn")](...mcp_log("warn",`${cname()}:chrome.runtime.sendMessage failed, reloading tab:`,e)),window.location.reload(!1)}},g.relay_to_content=e=>{l[sev("log")](...mcp_log("log",`${cname()}:relay_to_content:`,e));const t=e.data?e.data:e;return t.type=t.rtype,g[t.type](e)},g.ping=e=>{l[sev("log")](...mcp_log("log",`${cname()}:ping:`,e));const t=e.data?e.data:e;return"pong"},g.get_from_content=t=>{l[sev("log")](...mcp_log("log",`${cname()}:get_from_content:`,t));const n=t.data?t.data:t,r=o[n.key][n.prop];return n.result=r,n.type=n.ret,e?e.postMessage(n):window.postMessage(n,"*"),!0},g.set_to_content=e=>{l[sev("log")](...mcp_log("log",`${cname()}:set_to_content:`,e));const t=e.data?e.data:e;if(e.ports?.[0]&&(t.value=e.ports?.[0]),"window"===t.prop);else if("innerHTML"===t.prop&&t.value.selector&&t.value.html){const e=document.querySelector(t.value.selector),o=e?.querySelector("template");o&&t.value.html&&(o.innerHTML=t.value.html),injectPopoverResources(t.value.files)}return(o[t.key]??={})[t.prop]=t.value,!1},new MutationObserver(t=>{t.forEach(t=>{"childList"===t.type&&t.addedNodes.forEach(t=>{"SCRIPT"===t.nodeName&&t.addEventListener("load",o=>{baseURLFrom(t.src)===a&&t.src!=`${a}/content.js`&&t.src.endsWith(".js")&&e&&(l[sev("log")](...mcp_log("log",`🔍${cname()}:onload happened: sending unlock message:`,t.src)),e.postMessage({type:"unlock_access_token",src:t.src}),o.stopImmediatePropagation())},!0)})})}).observe(document.documentElement,{childList:!0,subtree:!0}),window.addEventListener("message",t=>{t.data?.access_token==r?n=getUUID():t.data?.access_token==n?(chrome.runtime.sendMessage(t.data),t.stopImmediatePropagation()):t.ports&&"get_access_token"==t.data?.type&&!t.data?.access_token&&(e=t.ports[0],e.postMessage({type:"get_access_token",access_token:d}),d=r,l[sev("log")](...mcp_log("log",`${cname()}:✅ set pagePort`)),e.onmessage=e=>{l[sev("log")](...mcp_log("log",`${cname()}:port2 Secure message:`,e)),e.isTrusted&&g[e.data.type](e)},t.stopImmediatePropagation())},!0),chrome.runtime.onMessage.addListener(t=>{l[sev("log")](...mcp_log("log",`${cname()}:onMessage:`,t)),"popover"!=t.type||g.ui_loaded||(t.resources.forEach(load),g.ui_loaded=!0),t?.private?"load"==t.type&&(t.modules?.forEach(loadAndRunModule),t.resources?.forEach(load)):e?e.postMessage(t):window.postMessage(t,"*")});const message=e=>(e.isTrusted&&(globalThis??self))[e?.data?.type]?.(e.data)}}).call({});